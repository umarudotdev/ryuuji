<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ section.title | default(value=config.title) }}</title>
  <meta name="description" content="{{ section.description | default(value=config.description) }}">

  <!-- Open Graph -->
  <meta property="og:title" content="{{ section.title | default(value=config.title) }}">
  <meta property="og:description" content="{{ section.description | default(value=config.description) }}">
  <meta property="og:type" content="website">
  <meta property="og:url" content="{{ current_url | default(value=config.base_url) }}">
  <meta property="og:image" content="{{ config.base_url }}/images/og-card.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{{ section.title | default(value=config.title) }}">
  <meta name="twitter:description" content="{{ section.description | default(value=config.description) }}">

  <!-- Favicon -->
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">

  <!-- Fonts: preload above-fold fonts -->
  <link rel="preload" href="/fonts/GeistVF.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/fonts/GeistPixel-Line.woff2" as="font" type="font/woff2" crossorigin>

  <!-- Styles -->
  <link rel="stylesheet" href="/main.css">

  <style>
    /* Critical: prevent FOUC */
    html { background-color: #1A1114; }

    /* Inline @font-face — browser discovers fonts before external CSS arrives */
    @font-face {
      font-family: "Geist";
      src: url("/fonts/GeistVF.woff2") format("woff2");
      font-weight: 100 900;
      font-display: swap;
      font-style: normal;
    }
    @font-face {
      font-family: "Geist Mono";
      src: url("/fonts/GeistMonoVF.woff2") format("woff2");
      font-weight: 100 900;
      font-display: swap;
      font-style: normal;
    }
    @font-face {
      font-family: "Geist Pixel Line";
      src: url("/fonts/GeistPixel-Line.woff2") format("woff2");
      font-weight: 400;
      font-display: swap;
      font-style: normal;
    }
  </style>
</head>
<body{% block body_attrs %}{% endblock body_attrs %}>
  {% block header %}
  <header id="site-nav">
    <nav>
      <a href="{{ get_url(path='@/_index.md', lang=lang) }}" class="nav-logo" aria-label="{{ trans(key='nav_home_aria', lang=lang) }}">
        <img src="/logo.svg" width="20" height="20" alt="">
        <span>Ryuuji</span>
      </a>

      <div class="nav-links">
        <a href="{{ get_url(path='@/overview/_index.md', lang=lang) }}#features">{{ trans(key="nav_features", lang=lang) }}</a>
        <a href="{{ get_url(path='@/overview/_index.md', lang=lang) }}#faq">{{ trans(key="nav_faq", lang=lang) }}</a>
      </div>

      <div class="nav-end">
        <div class="nav-lang-dropdown" id="lang-dropdown">
          <button class="nav-lang-trigger" aria-expanded="false" aria-haspopup="true">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></svg>
            {% if lang == "pt-br" %}PT{% else %}EN{% endif %}
            <svg class="nav-lang-chevron" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
          </button>
          <div class="nav-lang-menu">
            {% for t in section.translations %}
            <a href="{{ t.permalink }}"{% if t.lang == lang %} class="active" aria-current="true"{% endif %}>
              {% if t.lang == "pt-br" %}Português{% else %}English{% endif %}
            </a>
            {% endfor %}
          </div>
        </div>
        <a href="{{ config.extra.github_url }}" class="nav-icon" target="_blank" rel="noopener noreferrer" title="GitHub">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
        </a>
        <a href="{{ get_url(path='@/overview/_index.md', lang=lang) }}#download" class="nav-cta">{{ trans(key="nav_download", lang=lang) }}</a>
        <button class="nav-toggle" id="nav-toggle" aria-label="{{ trans(key='nav_menu', lang=lang) }}" aria-expanded="false">
          <svg class="icon-menu" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 5h16"/><path d="M4 12h16"/><path d="M4 19h16"/></svg>
          <svg class="icon-x" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
        </button>
      </div>

      <div class="nav-drawer" id="nav-drawer">
        <div class="nav-drawer-inner">
          <a href="{{ get_url(path='@/overview/_index.md', lang=lang) }}#features">
            <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>
            {{ trans(key="nav_features", lang=lang) }}
          </a>
          <a href="{{ get_url(path='@/overview/_index.md', lang=lang) }}#faq">
            <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>
            {{ trans(key="nav_faq", lang=lang) }}
          </a>
          <a href="{{ config.extra.github_url }}" target="_blank" rel="noopener noreferrer">
            <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
            GitHub
          </a>
          {% for t in section.translations %}{% if t.lang != lang %}
          <a href="{{ t.permalink }}" class="nav-lang-mobile">
            <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></svg>
            {% if t.lang == "pt-br" %}Português{% else %}English{% endif %}
          </a>
          {% endif %}{% endfor %}
        </div>
      </div>
    </nav>
  </header>
  {% endblock header %}

  <main>
    {% block content %}{% endblock content %}
  </main>

  {% block footer %}
  <footer class="footer" role="contentinfo">
    <div class="container footer-grid" data-stagger>
      <div class="footer-column footer-about" data-animate>
        <div class="footer-brand">
          <img src="/logo-mark.svg" width="24" height="24" alt="Ryuuji logo">
          Ryuuji
        </div>
        <p>{{ trans(key="footer_tagline", lang=lang) }}</p>
      </div>
      <nav class="footer-column" data-animate aria-label="{{ trans(key='footer_project', lang=lang) }}">
        <h4 class="footer-column-title">{{ trans(key="footer_project", lang=lang) }}</h4>
        <a href="{{ config.extra.github_url }}" target="_blank" rel="noopener noreferrer">GitHub</a>
        <a href="{{ config.extra.github_url }}/releases" target="_blank" rel="noopener noreferrer">{{ trans(key="footer_releases", lang=lang) }}</a>
        <a href="{{ config.extra.github_url }}/issues" target="_blank" rel="noopener noreferrer">{{ trans(key="footer_issues", lang=lang) }}</a>
      </nav>
      <nav class="footer-column" data-animate aria-label="{{ trans(key='footer_resources', lang=lang) }}">
        <h4 class="footer-column-title">{{ trans(key="footer_resources", lang=lang) }}</h4>
        <a href="{{ config.extra.github_url }}/blob/main/docs/prd.md" target="_blank" rel="noopener noreferrer">{{ trans(key="footer_docs", lang=lang) }}</a>
        <a href="{{ config.extra.github_url }}/blob/main/CONTRIBUTING.md" target="_blank" rel="noopener noreferrer">{{ trans(key="footer_contributing", lang=lang) }}</a>
        <a href="{{ config.extra.github_url }}/blob/main/LICENSE" target="_blank" rel="noopener noreferrer">{{ trans(key="footer_license", lang=lang) }}</a>
      </nav>
    </div>
  </footer>
  {% endblock footer %}

  <script>
    // i18n strings for JS
    var i18n = { copy: '{{ trans(key="copy", lang=lang) }}', copied: '{{ trans(key="copied", lang=lang) }}' };

    // Navbar: scroll state & mobile menu
    (function() {
      var nav = document.getElementById('site-nav');
      var toggle = document.getElementById('nav-toggle');
      var ticking = false;

      window.addEventListener('scroll', function() {
        if (!ticking) {
          requestAnimationFrame(function() {
            nav.classList.toggle('scrolled', window.scrollY > 20);
            ticking = false;
          });
          ticking = true;
        }
      }, { passive: true });

      if (toggle) {
        toggle.addEventListener('click', function() {
          var open = nav.classList.toggle('open');
          toggle.setAttribute('aria-expanded', open);
        });
      }

      // Language dropdown
      var langDropdown = document.getElementById('lang-dropdown');
      if (langDropdown) {
        var langTrigger = langDropdown.querySelector('.nav-lang-trigger');
        langTrigger.addEventListener('click', function() {
          var open = langDropdown.classList.toggle('open');
          langTrigger.setAttribute('aria-expanded', open);
        });
      }

      // Close nav menu & lang dropdown on outside click / Escape
      document.addEventListener('click', function(e) {
        if (toggle && nav.classList.contains('open') && !nav.contains(e.target)) {
          nav.classList.remove('open');
          toggle.setAttribute('aria-expanded', 'false');
        }
        if (langDropdown && langDropdown.classList.contains('open') && !langDropdown.contains(e.target)) {
          langDropdown.classList.remove('open');
          langDropdown.querySelector('.nav-lang-trigger').setAttribute('aria-expanded', 'false');
        }
      });

      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          if (toggle && nav.classList.contains('open')) {
            nav.classList.remove('open');
            toggle.setAttribute('aria-expanded', 'false');
            toggle.focus();
          }
          if (langDropdown && langDropdown.classList.contains('open')) {
            langDropdown.classList.remove('open');
            langDropdown.querySelector('.nav-lang-trigger').setAttribute('aria-expanded', 'false');
            langDropdown.querySelector('.nav-lang-trigger').focus();
          }
        }
      });
    })();

    // Code block copy button
    // SVG templates as inert DOM fragments (no innerHTML on live elements)
    var iconTemplate = document.createElement('template');
    iconTemplate.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>';
    var checkTemplate = document.createElement('template');
    checkTemplate.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>';

    function setCopyState(button, icon, text) {
      while (button.firstChild) button.removeChild(button.firstChild);
      button.appendChild(icon.cloneNode(true));
      var span = document.createElement('span');
      span.textContent = text;
      button.appendChild(span);
    }

    document.querySelectorAll('.code-block').forEach(function(block) {
      var button = document.createElement('button');
      button.className = 'copy-btn';
      setCopyState(button, iconTemplate.content.firstChild, i18n.copy);

      button.onclick = function() {
        var cmd = block.querySelector('.cmd').innerText;
        navigator.clipboard.writeText(cmd).then(function() {
          setCopyState(button, checkTemplate.content.firstChild, i18n.copied);
          button.classList.add('copied');
          setTimeout(function() {
            setCopyState(button, iconTemplate.content.firstChild, i18n.copy);
            button.classList.remove('copied');
          }, 2000);
        });
      };
      block.appendChild(button);
    });
  </script>

  <script>
    // Scroll-triggered entrance animations
    (function() {
      var els = document.querySelectorAll('[data-animate]');
      var staggerEls = document.querySelectorAll('[data-stagger]');
      if (!els.length && !staggerEls.length) return;

      // Instant reveal: respect reduced motion or missing IO
      var instant = window.matchMedia('(prefers-reduced-motion: reduce)').matches
        || !('IntersectionObserver' in window);
      if (instant) {
        els.forEach(function(el) { el.classList.add('is-visible'); });
        staggerEls.forEach(function(el) { el.classList.add('is-visible'); });
        return;
      }

      var observer = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
          if (entry.isIntersecting) {
            entry.target.classList.add('is-visible');
            observer.unobserve(entry.target);
          }
        });
      }, { threshold: 0.15, rootMargin: '0px 0px -40px 0px' });

      els.forEach(function(el) {
        if (!el.parentElement || !el.parentElement.hasAttribute('data-stagger')) {
          observer.observe(el);
        }
      });
      staggerEls.forEach(function(el) { observer.observe(el); });
    })();
  </script>
</body>
</html>
